# Test-Automation-Framework 项目文档（精简版）

## 项目概述

本项目是一个基于Python的API自动化测试框架，采用pytest + YAML数据驱动 + Allure报告的技术方案，旨在解决传统手工测试效率低、覆盖不全、成本高等问题。框架支持单接口测试和业务流程测试，通过YAML格式编写测试用例，实现测试数据与代码分离，提供灵活的参数替换、多种断言方式、接口关联等功能，并生成直观的Allure测试报告。

## 项目背景与目的

**背景**：传统API测试存在效率低下、覆盖不全、成本高、数据管理混乱、报告不直观等问题。

**目的**：构建高效、易用、可维护的API自动化测试框架，提高测试效率和质量，降低维护成本，支持CI/CD集成。

## 项目结构

框架采用模块化设计，主要包含：
- **base/**：核心工具类（apiutil.py单接口测试、apiutil_business.py业务流程测试）
- **common/**：公共模块（断言、请求发送、YAML读写、日志、数据库连接等）
- **conf/**：配置文件管理
- **testcase/**：测试用例（单接口测试、业务流程测试）
- **data/**：测试数据（CSV、Excel、YAML等）
- **report/**：测试报告（Allure、TM报告）

## 技术难点与解决方案

### 1. 动态参数替换
**难点**：YAML中需要支持函数调用和变量引用，实现动态参数生成。
**解决**：通过字符串解析识别`${函数名(参数)}`格式，使用Python反射机制（getattr）动态调用DebugTalk类中的函数，支持嵌套替换和多种数据类型。

### 2. 接口关联与数据传递
**难点**：业务流程测试需要多个接口串联，前一个接口的响应数据需传递给后续接口。
**解决**：设计extract.yaml文件存储提取的变量，支持正则表达式和JSONPath两种提取方式，通过`get_extract_data()`函数实现跨接口数据传递。

### 3. 灵活的断言机制
**难点**：不同接口需要不同的断言方式（状态码、响应内容、数据库等）。
**解决**：采用策略模式，实现contains（包含）、eq（相等）、ne（不相等）、rv（任意值）、db（数据库）等多种断言方式，使用flag标识断言结果，集成Allure报告展示。

### 4. 测试数据管理
**难点**：测试数据来源多样，需要与代码分离，支持数据驱动。
**解决**：采用YAML格式编写测试用例，使用`@pytest.mark.parametrize`实现数据驱动，提供CSV、Excel、YAML等多种数据读取方式，通过DebugTalk类提供动态数据生成函数。

### 5. 测试报告生成
**难点**：需要生成直观、详细的测试报告，支持历史趋势分析。
**解决**：集成Allure报告，使用`allure.attach()`附加请求参数、响应数据等详细信息，通过`@allure.story`和`@allure.feature`组织测试结构，自动记录历史执行结果。

### 6. 异常处理与日志
**难点**：需要完善的异常处理和详细的日志记录。
**解决**：使用Python logging模块实现分级日志（DEBUG、INFO、ERROR），按日期生成日志文件，使用try-except捕获异常并记录详细错误信息。

### 7. 业务流程测试
**难点**：需要支持多个接口串联执行，处理接口间依赖。
**解决**：设计支持多个baseInfo的YAML格式，按顺序执行接口，通过extract.yaml实现数据传递，使用独立的apiutil_business.py处理业务流程测试。

## 核心特性

1. **YAML数据驱动**：测试用例与代码分离，易于维护
2. **动态参数替换**：支持函数调用、变量引用，满足复杂场景
3. **多种断言方式**：包含、相等、不相等、数据库断言等
4. **接口关联支持**：通过extract.yaml实现接口间数据传递
5. **丰富工具函数**：加密、时间处理、数据读取等
6. **Allure报告**：详细的测试结果和历史趋势
7. **完善日志系统**：分级日志，便于问题定位

## 技术栈

pytest + Allure + YAML + requests + jsonpath + MySQL/Redis/ClickHouse/MongoDB + Jenkins

## 适用场景

API接口测试、业务流程测试、回归测试、持续集成测试

