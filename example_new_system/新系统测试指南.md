# æ–°ç³»ç»Ÿæµ‹è¯•æŒ‡å— - å•ç‹¬æµ‹è¯•ä¸AllureæŠ¥å‘Š

## ğŸ¯ **å¿«é€Ÿå¼€å§‹**

### **æ–¹æ³•1ï¼šç›´æ¥æµ‹è¯•æ–°ç³»ç»Ÿï¼ˆæ¨èï¼‰**

```bash
# 1. ç¡®ä¿mockæœåŠ¡å™¨è¿è¡Œ
cd mock_server/api_server
python base/flask_service.py

# 2. åœ¨æ–°ç»ˆç«¯ä¸­è¿è¡Œæ–°ç³»ç»Ÿæµ‹è¯•å¹¶ç”ŸæˆAllureæŠ¥å‘Š
pytest example_new_system/testcase/ --alluredir=report/new_system_temp -v

# 3. æŸ¥çœ‹AllureæŠ¥å‘Š
allure serve report/new_system_temp
```

### **æ–¹æ³•2ï¼šä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•è„šæœ¬**

```bash
# åˆ›å»ºå¹¶è¿è¡Œæ–°ç³»ç»Ÿä¸“ç”¨æµ‹è¯•è„šæœ¬
python run_new_system.py
```

## ğŸ“‹ **è¯¦ç»†æ­¥éª¤è¯´æ˜**

### **æ­¥éª¤1ï¼šå‡†å¤‡ç¯å¢ƒ**

```bash
# æ£€æŸ¥ä¾èµ–
pip list | findstr allure
pip list | findstr pytest

# å¦‚æœç¼ºå°‘ä¾èµ–ï¼Œå®‰è£…
pip install allure-pytest pytest
```

### **æ­¥éª¤2ï¼šå¯åŠ¨MockæœåŠ¡å™¨**

```bash
# æ–¹æ³•Aï¼šæ‰‹åŠ¨å¯åŠ¨
cd mock_server/api_server
python base/flask_service.py

# æ–¹æ³•Bï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
start /b python mock_server/api_server/base/flask_service.py
```

### **æ­¥éª¤3ï¼šè¿è¡Œæ–°ç³»ç»Ÿæµ‹è¯•**

#### **åŸºç¡€æµ‹è¯•å‘½ä»¤**
```bash
# è¿è¡Œæ‰€æœ‰æ–°ç³»ç»Ÿæµ‹è¯•
pytest example_new_system/testcase/ -v

# è¿è¡Œç‰¹å®šæ¨¡å—
pytest example_new_system/testcase/Order/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest example_new_system/testcase/Order/test_order.py -v
```

#### **ç”ŸæˆAllureæŠ¥å‘Š**
```bash
# ç”Ÿæˆæµ‹è¯•æ•°æ®
pytest example_new_system/testcase/ --alluredir=report/new_system_temp -v

# å¯åŠ¨AllureæœåŠ¡æŸ¥çœ‹æŠ¥å‘Š
allure serve report/new_system_temp

# æˆ–ç”Ÿæˆé™æ€HTMLæŠ¥å‘Š
allure generate report/new_system_temp -o report/new_system_html --clean
```

### **æ­¥éª¤4ï¼šé«˜çº§æµ‹è¯•é€‰é¡¹**

#### **å¹¶è¡Œæµ‹è¯•**
```bash
# å®‰è£…å¹¶è¡Œæµ‹è¯•æ’ä»¶
pip install pytest-xdist

# å¹¶è¡Œè¿è¡Œæµ‹è¯•
pytest example_new_system/testcase/ --alluredir=report/new_system_temp -n 2 -v
```

#### **å¤±è´¥é‡è¯•**
```bash
# å®‰è£…é‡è¯•æ’ä»¶
pip install pytest-rerunfailures

# å¤±è´¥æ—¶é‡è¯•
pytest example_new_system/testcase/ --alluredir=report/new_system_temp --reruns 2 -v
```

#### **è¯¦ç»†è¾“å‡º**
```bash
# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯å’Œprintè¾“å‡º
pytest example_new_system/testcase/ --alluredir=report/new_system_temp -vs --tb=short
```

## ğŸ”§ **è‡ªå®šä¹‰é…ç½®**

### **åˆ›å»ºæ–°ç³»ç»Ÿä¸“ç”¨é…ç½®æ–‡ä»¶**

åˆ›å»º `example_new_system/pytest.ini`:
```ini
[pytest]
testpaths = ./testcase/
addopts = -vs --alluredir=../report/new_system_temp --tb=short
python_files = test_*.py
python_classes = Test*
python_functions = test
markers =
    order: æµ‹è¯•æ‰§è¡Œé¡ºåº
    smoke: å†’çƒŸæµ‹è¯•
    regression: å›å½’æµ‹è¯•
```

### **ä½¿ç”¨é…ç½®æ–‡ä»¶è¿è¡Œ**
```bash
cd example_new_system
pytest
```

## ğŸš€ **ä¸€é”®æµ‹è¯•è„šæœ¬**

åˆ›å»º `run_new_system.py` è„šæœ¬ï¼š

```python
#!/usr/bin/env python3
import os
import sys
import subprocess
import time
import webbrowser
from pathlib import Path

def run_new_system_tests():
    """è¿è¡Œæ–°ç³»ç»Ÿæµ‹è¯•å¹¶ç”ŸæˆAllureæŠ¥å‘Š"""
    
    print("ğŸš€ å¼€å§‹æ–°ç³»ç»Ÿæµ‹è¯•...")
    
    # 1. æ£€æŸ¥mockæœåŠ¡å™¨
    print("ğŸ“¡ æ£€æŸ¥MockæœåŠ¡å™¨çŠ¶æ€...")
    try:
        import requests
        response = requests.get("http://127.0.0.1:8787/health", timeout=3)
        print("âœ… MockæœåŠ¡å™¨è¿è¡Œæ­£å¸¸")
    except:
        print("âŒ MockæœåŠ¡å™¨æœªå¯åŠ¨ï¼Œè¯·å…ˆå¯åŠ¨æœåŠ¡å™¨")
        print("å¯åŠ¨å‘½ä»¤: python mock_server/api_server/base/flask_service.py")
        return False
    
    # 2. æ¸…ç†æ—§æŠ¥å‘Š
    report_dir = Path("report/new_system_temp")
    if report_dir.exists():
        import shutil
        shutil.rmtree(report_dir)
        print("ğŸ§¹ æ¸…ç†æ—§æŠ¥å‘Š")
    
    # 3. è¿è¡Œæµ‹è¯•
    print("ğŸ§ª è¿è¡Œæ–°ç³»ç»Ÿæµ‹è¯•...")
    cmd = [
        "pytest", 
        "example_new_system/testcase/",
        "--alluredir=report/new_system_temp",
        "-v",
        "--tb=short"
    ]
    
    result = subprocess.run(cmd, capture_output=True, text=True)
    
    # 4. æ˜¾ç¤ºæµ‹è¯•ç»“æœ
    print("\n" + "="*50)
    print("ğŸ“Š æµ‹è¯•ç»“æœ:")
    print("="*50)
    print(result.stdout)
    
    if result.stderr:
        print("âš ï¸ è­¦å‘Šä¿¡æ¯:")
        print(result.stderr)
    
    # 5. ç”Ÿæˆå¹¶æ‰“å¼€AllureæŠ¥å‘Š
    if report_dir.exists():
        print("ğŸ“ˆ ç”ŸæˆAllureæŠ¥å‘Š...")
        try:
            # å¯åŠ¨AllureæœåŠ¡
            subprocess.Popen([
                "allure", "serve", "report/new_system_temp"
            ])
            print("âœ… AllureæŠ¥å‘Šå·²å¯åŠ¨ï¼Œæµè§ˆå™¨å°†è‡ªåŠ¨æ‰“å¼€")
            print("ğŸ“ æŠ¥å‘Šåœ°å€: http://localhost:éšæœºç«¯å£")
        except FileNotFoundError:
            print("âŒ Allureæœªå®‰è£…ï¼Œç”Ÿæˆé™æ€æŠ¥å‘Š...")
            subprocess.run([
                "allure", "generate", 
                "report/new_system_temp", 
                "-o", "report/new_system_html", 
                "--clean"
            ])
            # æ‰“å¼€é™æ€æŠ¥å‘Š
            html_file = Path("report/new_system_html/index.html").absolute()
            webbrowser.open(f"file://{html_file}")
            print(f"âœ… é™æ€æŠ¥å‘Šå·²ç”Ÿæˆ: {html_file}")
    
    return result.returncode == 0

if __name__ == "__main__":
    success = run_new_system_tests()
    sys.exit(0 if success else 1)
```

## ğŸ“Š **æŠ¥å‘ŠæŸ¥çœ‹æ–¹å¼**

### **å®æ—¶æŠ¥å‘Šï¼ˆæ¨èï¼‰**
```bash
# å¯åŠ¨å®æ—¶æœåŠ¡
allure serve report/new_system_temp

# ç‰¹ç‚¹ï¼š
# âœ… å®æ—¶æ›´æ–°
# âœ… äº¤äº’å¼ç•Œé¢
# âœ… è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤
# âœ… å¤±è´¥æˆªå›¾å’Œæ—¥å¿—
```

### **é™æ€æŠ¥å‘Š**
```bash
# ç”Ÿæˆé™æ€HTML
allure generate report/new_system_temp -o report/new_system_html --clean

# æ‰“å¼€æŠ¥å‘Š
start report/new_system_html/index.html

# ç‰¹ç‚¹ï¼š
# âœ… å¯ä»¥ç¦»çº¿æŸ¥çœ‹
# âœ… å¯ä»¥åˆ†äº«ç»™ä»–äºº
# âœ… é€‚åˆCI/CDé›†æˆ
```

## ğŸ¨ **æŠ¥å‘Šå®šåˆ¶**

### **æ·»åŠ ç¯å¢ƒä¿¡æ¯**
åˆ›å»º `example_new_system/environment.properties`:
```properties
System=æ–°è®¢å•ç®¡ç†ç³»ç»Ÿ
Version=1.0.0
Environment=æµ‹è¯•ç¯å¢ƒ
Base.URL=http://127.0.0.1:8787
Test.Framework=pytest + allure
Browser=APIæµ‹è¯•
```

### **æ·»åŠ æµ‹è¯•åˆ†ç±»**
åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨æ ‡è®°ï¼š
```python
import allure
import pytest

@allure.feature("è®¢å•ç®¡ç†")
@allure.story("åˆ›å»ºè®¢å•")
@allure.severity(allure.severity_level.CRITICAL)
@pytest.mark.smoke
def test_create_order():
    """åˆ›å»ºè®¢å•çš„å†’çƒŸæµ‹è¯•"""
    pass
```

## ğŸ” **è°ƒè¯•æŠ€å·§**

### **è¯¦ç»†æ—¥å¿—è¾“å‡º**
```bash
# æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
pytest example_new_system/testcase/ -v -s --log-cli-level=INFO

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest example_new_system/testcase/ --lf -v

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest example_new_system/testcase/ -x -v
```

### **ç‰¹å®šæµ‹è¯•è¿è¡Œ**
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
pytest example_new_system/testcase/Order/test_order.py::TestOrder::test_create_order -v

# è¿è¡ŒåŒ…å«ç‰¹å®šå…³é”®å­—çš„æµ‹è¯•
pytest example_new_system/testcase/ -k "create" -v

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
pytest example_new_system/testcase/ -m "smoke" -v
```

## ğŸ“ **æœ€ä½³å®è·µ**

### **1. æµ‹è¯•å‰æ£€æŸ¥æ¸…å•**
- [ ] MockæœåŠ¡å™¨å·²å¯åŠ¨
- [ ] æµ‹è¯•æ•°æ®å·²å‡†å¤‡
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ä¾èµ–åº“å·²å®‰è£…

### **2. æŠ¥å‘Šä¼˜åŒ–å»ºè®®**
- ä½¿ç”¨æœ‰æ„ä¹‰çš„æµ‹è¯•åç§°
- æ·»åŠ è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤
- åŒ…å«å¿…è¦çš„æ–­è¨€ä¿¡æ¯
- è®°å½•å…³é”®çš„æµ‹è¯•æ•°æ®

### **3. æŒç»­é›†æˆå»ºè®®**
```bash
# CI/CDè„šæœ¬ç¤ºä¾‹
#!/bin/bash
# å¯åŠ¨æœåŠ¡
python mock_server/api_server/base/flask_service.py &
SERVER_PID=$!

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# è¿è¡Œæµ‹è¯•
pytest example_new_system/testcase/ --alluredir=report/new_system_temp

# ç”ŸæˆæŠ¥å‘Š
allure generate report/new_system_temp -o report/new_system_html --clean

# æ¸…ç†
kill $SERVER_PID
```

## ğŸ¯ **å¿«é€Ÿå‘½ä»¤å‚è€ƒ**

```bash
# åŸºç¡€æµ‹è¯•
pytest example_new_system/testcase/ -v

# ç”ŸæˆæŠ¥å‘Š
pytest example_new_system/testcase/ --alluredir=report/new_system_temp -v

# æŸ¥çœ‹æŠ¥å‘Š
allure serve report/new_system_temp

# ä¸€é”®æµ‹è¯•
python run_new_system.py

# è°ƒè¯•æ¨¡å¼
pytest example_new_system/testcase/ -vs --tb=long

# å¹¶è¡Œæµ‹è¯•
pytest example_new_system/testcase/ -n 2 --alluredir=report/new_system_temp
```